# Installing Tekton Results

This document explains how to install Tekton Results with local database. If you
want to use an external database, please refer [this page](./external-database.md).

## Prerequisites

1. [Tekton Pipelines](https://github.com/tektoncd/pipeline/blob/main/docs/install.md)
   must be installed on the cluster.
2. Generating a database root password.

   A database root password must be generated by the user and stored in a
   [Kubernetes Secret](https://kubernetes.io/docs/concepts/configuration/secret/)
   before installing. By default, Tekton Results expects this `Secret` to have
   the following properties:

   - namespace: `tekton-pipelines`
   - name: `tekton-results-postgres`
   - contains the fields:
     - `POSTGRES_USER=postgres`
     - `POSTGRES_PASSWORD=<your password>`

   If you are not using a particular password management strategy, the following
   command will generate a random password for you:

   ```sh
   kubectl create secret generic tekton-results-postgres --namespace="tekton-pipelines" --from-literal=POSTGRES_USER=postgres --from-literal=POSTGRES_PASSWORD=$(openssl rand -base64 20)
   ```

3. Generate cert/key pair. Note: Feel free to use any cert management software
   to do this!

   Tekton Results expects the cert/key pair to be stored in a
   [TLS Kubernetes Secret](https://kubernetes.io/docs/concepts/configuration/secret/#tls-secrets) named `tekton-results-tls`.

   - Generate new self-signed cert

   ```sh
   openssl req -x509 \
   -newkey rsa:4096 \
   -keyout key.pem \
   -out cert.pem \
   -days 365 \
   -nodes \
   -subj "/CN=tekton-results-api-service.tekton-pipelines.svc.cluster.local" \
   -addext "subjectAltName = DNS:tekton-results-api-service.tekton-pipelines.svc.cluster.local"
   ```

   - Create new TLS Secret from cert.

   ```sh
   kubectl create secret tls -n tekton-pipelines tekton-results-tls \
   --cert=cert.pem \
   --key=key.pem
   ```

## Installing latest release

```sh
kubectl apply -f https://storage.googleapis.com/tekton-releases/results/latest/release.yaml
```

## Installing specific release

```sh
export RELEASE_VERSION="<desired release version here>"
kubectl apply -f https://storage.googleapis.com/tekton-releases/results/previous/${RELEASE_VERSION}/release.yaml
```

## Installing from source

See [DEVELOPMENT.md](DEVELOPMENT.md) for how to install Tekton Results from
source.
